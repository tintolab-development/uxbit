name: Sync Component Docs to Issues

on:
  push:
    paths:
      - 'apps/stencil-components/docs/components/*.md' # ì´ ê²½ë¡œì˜ mdê°€ ë°”ë€Œë©´ ë™ì‘
      - 'apps/stencil-components/src/components/**/*.tsx' # ì»´í¬ë„ŒíŠ¸ ì½”ë“œ ë³€ê²½ ì‹œì—ë„ ë™ì‘

permissions:
  contents: read
  issues: write

jobs:
  writing-component-guidelines:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      # ğŸ”¥ í•„ìš”í•œ ë¼ë²¨ì´ ì—†ìœ¼ë©´ ìë™ ìƒì„±
      - name: Ensure labels exist
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
          echo "Ensuring labels exist..."
          gh label create "type:docs" --color "1D76DB" --repo "$REPO" --description "Documentation" || true
          gh label create "area:components" --color "0E8A16" --repo "$REPO" --description "Components area" || true
          gh label create "priority:normal" --color "FBCA04" --repo "$REPO" --description "Normal priority" || true

      # ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ ë½‘ê¸°
      - name: Get changed files
        id: changed
        uses: tj-actions/changed-files@v45
        with:
          files: |
            apps/stencil-components/docs/components/*.md

      # ì»´í¬ë„ŒíŠ¸ ë¹Œë“œ (custom-elements.json ìƒì„±)
      - name: Build components
        if: steps.changed.outputs.any_changed == 'true'
        run: |
          pnpm --filter @uxbit/stencil-components run build

      # ì»´í¬ë„ŒíŠ¸ í’ˆì§ˆ í‰ê°€ ì‹¤í–‰ (ì„ íƒì )
      - name: Evaluate component quality
        if: steps.changed.outputs.any_changed == 'true'
        id: quality
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
          set -euo pipefail

          # MCP ì„œë²„ë¥¼ í†µí•œ í‰ê°€ëŠ” ë¡œì»¬ í™˜ê²½ì—ì„œ ìˆ˜ë™ ì‹¤í–‰ ê¶Œì¥
          # ì—¬ê¸°ì„œëŠ” ë¬¸ì„œ íŒŒì¼ì—ì„œ í’ˆì§ˆ í‰ê°€ ì„¹ì…˜ì„ ì¶”ì¶œí•˜ê±°ë‚˜
          # ê¸°ë³¸ ì •ë³´ë§Œ í¬í•¨
          echo "Component quality evaluation should be done manually using MCP server"
          echo "Use: evaluate_component_quality tool in Cursor"

      - name: Create or update issues for changed files
        if: steps.changed.outputs.all_changed_files != ''
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
          chmod +x .github/scripts/sync-component-issues.sh
          .github/scripts/sync-component-issues.sh ${{ steps.changed.outputs.all_changed_files }}
